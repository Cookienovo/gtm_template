___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Cookienovo",
  "categories": [
    "TAG_MANAGEMENT",
    "UTILITY"
  ],
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "brand": {
    "id": "github.com_Cookienovo",
    "displayName": "Cookienovo",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Cookie banner (CMP) by Cookienovo\nhttps://cookienovo.com/",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "id",
    "displayName": "Site token",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "STRING_LENGTH",
        "args": [
          40,
          60
        ]
      }
    ],
    "clearOnCopy": true,
    "help": "Site token can be found in your Cookienovo"
  },
  {
    "type": "SELECT",
    "name": "consent_mode_enabled",
    "displayName": "Consent Mode v2",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": false,
        "displayValue": "Disabled"
      },
      {
        "value": true,
        "displayValue": "Enabled"
      }
    ],
    "simpleValueType": true,
    "alwaysInSummary": true,
    "defaultValue": true,
    "help": "If enabled, consent mode v2 will be supported. The default state will be set when the tag is loaded. If consent has been granted, consent update will also be called with the appropriate permissions."
  },
  {
    "type": "GROUP",
    "name": "default_consents",
    "displayName": "Default consent states",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "default_consent_functionality",
        "displayName": "Functionality",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "alwaysInSummary": true,
        "help": "Consent state for functionality_storage"
      },
      {
        "type": "SELECT",
        "name": "default_consent_marketing",
        "displayName": "Marketing",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "alwaysInSummary": true,
        "help": "Consent state for ad_storage, ad_personalization and ad_user_data"
      },
      {
        "type": "SELECT",
        "name": "default_consent_analytics",
        "displayName": "Analytics",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "alwaysInSummary": true,
        "help": "Consent state for analytics_storage"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "google_tag_configs",
    "displayName": "Google Tag Configs",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "TEXT",
        "name": "wait_for_update",
        "displayName": "Wait for update",
        "simpleValueType": true,
        "defaultValue": 2000,
        "alwaysInSummary": true,
        "canBeEmptyString": false,
        "help": "When wait_for_update is set to some value, the tag will pause its execution until updated consent state is detected or timeout occurs. This helps ensure accurate consent-based behavior when tags fire before consent is captured.",
        "valueValidators": [
          {
            "type": "NON_NEGATIVE_NUMBER"
          }
        ],
        "valueHint": "2000",
        "valueUnit": "ms"
      },
      {
        "type": "SELECT",
        "name": "url_passthrough",
        "displayName": "URL passthrough",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": false,
            "displayValue": "false"
          },
          {
            "value": true,
            "displayValue": "true"
          }
        ],
        "simpleValueType": true,
        "defaultValue": false,
        "help": "When a visitor has cookies disabled (ad_storage or analytics_storage set to \u0027denied\u0027), URL passthrough can transmit ad click information and analytics data across pages using URL parameters."
      },
      {
        "type": "SELECT",
        "name": "ads_data_redaction",
        "displayName": "Google Ads Data Redaction",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": false,
            "displayValue": "false"
          },
          {
            "value": true,
            "displayValue": "true"
          }
        ],
        "simpleValueType": true,
        "help": "When ad_storage is denied, no new advertising cookies are set and existing third-party cookies from Google domains won\u0027t be used, though the full URL including ad click data will still be sent to Google. To further protect user privacy, enabling ads_data_redaction will redact ad click identifiers in network requests when ad_storage is denied.",
        "defaultValue": false
      },
      {
        "type": "PARAM_TABLE",
        "name": "region_specific",
        "displayName": "Region specific",
        "paramTableColumns": [
          {
            "param": {
              "type": "TEXT",
              "name": "region",
              "displayName": "Region",
              "simpleValueType": true,
              "valueValidators": [
                {
                  "type": "NON_EMPTY"
                }
              ],
              "help": "Code of region in ISO 3166-2 format, like \"US\", \"SK\", etc.",
              "valueHint": "ES,US-AK"
            },
            "isUnique": true
          },
          {
            "param": {
              "type": "SELECT",
              "name": "functionality",
              "displayName": "functional (functionality_storage)",
              "macrosInSelect": true,
              "selectItems": [
                {
                  "value": "denied",
                  "displayValue": "denied"
                },
                {
                  "value": "granted",
                  "displayValue": "granted"
                }
              ],
              "simpleValueType": true,
              "defaultValue": "denied",
              "help": "Default state of functionality_storage in given region"
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "SELECT",
              "name": "analytics",
              "displayName": "analytics (analytics_storage)",
              "macrosInSelect": true,
              "selectItems": [
                {
                  "value": "denied",
                  "displayValue": "denied"
                },
                {
                  "value": "granted",
                  "displayValue": "granted"
                }
              ],
              "simpleValueType": true,
              "help": "Default state of analytics_storage in given region",
              "defaultValue": "denied"
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "SELECT",
              "name": "marketing",
              "displayName": "marketing (ad_storage, ad_personalization, ad_user_data)",
              "macrosInSelect": true,
              "selectItems": [
                {
                  "value": "denied",
                  "displayValue": "denied"
                },
                {
                  "value": "granted",
                  "displayValue": "granted"
                }
              ],
              "simpleValueType": true,
              "defaultValue": "denied",
              "help": "Default state of ad_storage, ad_personalization and ad_user_data in given region"
            },
            "isUnique": false
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// https://developers.google.com/tag-platform/tag-manager/templates/consent-apis
// https://developers.google.com/tag-platform/tag-manager/templates/api#injectscript

// https://cookienovo.com/app/sites/35be4000-6e4e-47f5-aa30-f29b03492afb
// https://kisk.sabatka.net/?dltype=gtm&gtmid=GTM-NM7B43FK

const log = require('logToConsole');
const setDefaultConsentState = require('setDefaultConsentState');
const updateConsentState = require('updateConsentState');
const getCookieValues = require('getCookieValues');
const injectScript = require('injectScript');
const Object = require('Object');
const gtagSet = require('gtagSet');
const createQueue = require('createQueue');
const setInWindow = require('setInWindow');


setInWindow('cookienovo_token', data.id, true);


function loadConsentFromCookie(consent) {
  var status = getCookieValues(consent);
  if (status.length === 0) return undefined;
  return (status[0] == 1) ? 'granted' : 'denied'; 
}



const defaultConsentState = {
  'ad_storage': data.default_consent_marketing,
  'ad_user_data': data.default_consent_marketing,
  'ad_personalization': data.default_consent_marketing,
  'analytics_storage': data.default_consent_analytics,
  'functionality_storage': data.default_consent_functionality,
//  'personalization_storage': data.default_consent_functionality,   // @TODO
//  'security_storage': data.default_consent_functionality,   // @TODO
  'wait_for_update': data.wait_for_update
};


if (data.consent_mode_enabled) {
  gtagSet('ads_data_redaction', data.ads_data_redaction);
  gtagSet('url_passthrough', data.url_passthrough);
  gtagSet('developer_id.dMjZhMT', true);
  log("Cookienovo: setting default state", defaultConsentState);
  setDefaultConsentState(defaultConsentState);

  data.region_specific = data.region_specific || [];
  for (let i = 0; i < data.region_specific.length; i++) {
    let rcs = data.region_specific[i];
    let regionConsentState = {
      'region': rcs.region.split(','),
      'ad_storage': rcs.marketing,
      'ad_user_data': rcs.marketing,
      'ad_personalization': rcs.marketing,
      'analytics_storage': rcs.analytics,
      'functionality_storage': rcs.functionality,
//    'personalization_storage': rcs.functionality,  // @TODO - toto dořešit
//    'security_storage': rcs.functionality,  // @TODO - toto dořešit
    };
    setDefaultConsentState(regionConsentState);
    log("Cookienovo: setting default state for region", regionConsentState);
  }
}



const cookienovoState = {
  'analytics': loadConsentFromCookie('cn-category-analytics'),
  'marketing': loadConsentFromCookie('cn-category-marketing'),
  'functionality': loadConsentFromCookie('cn-category-functional')
};
let updatedState = {};
if (cookienovoState.analytics !== undefined && cookienovoState.analytics !== data.default_consent_analytics) {
  updatedState.analytics_storage = cookienovoState.analytics;
}
if (cookienovoState.marketing !== undefined && cookienovoState.marketing !== data.default_consent_marketing) {
  updatedState.ad_storage = cookienovoState.marketing;
  updatedState.ad_user_data = cookienovoState.marketing;
  updatedState.ad_personalization = cookienovoState.marketing;
}
if (cookienovoState.functionality !== undefined && cookienovoState.functionality !== data.default_consent_functionality) {
  updatedState.functionality_storage = cookienovoState.functionality;
//  updatedState.personalization_storage = cookienovoState.functionality;
//  updatedState.security_storage = cookienovoState.functionality;
}
if (Object.keys(updatedState).length > 0) {
  log("Cookienovo: update consent mode with state", updatedState);
  if (data.consent_mode_enabled) {
    updateConsentState(updatedState);
  } else {
    const dataLayerPush = createQueue('dataLayer');
    dataLayerPush({
      'consent': updatedState,
      'event': 'cookie_consent_updated'
    });
  }
}


const url = 'https://cookienovo.com/assets/client.js';
injectScript(url, () => {
  log("Cookienovo: stript loaded", data);
  setInWindow('cookienovo_injected', true, true);
  data.gtmOnSuccess();
}, () => {
  log("Cookienovo: stript loading failed", data);
  data.gtmOnFailure();
});


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "cn-category-analytics"
              },
              {
                "type": 1,
                "string": "cn-category-functional"
              },
              {
                "type": 1,
                "string": "cn-category-marketing"
              },
              {
                "type": 1,
                "string": "cn-category-necessary"
              },
              {
                "type": 1,
                "string": "cn-consent-time"
              },
              {
                "type": 1,
                "string": "cn-dismissed"
              },
              {
                "type": 1,
                "string": "consent_cookies"
              },
              {
                "type": 1,
                "string": "cookienovolanguage"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wait_for_update"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "url_passthrough"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "region"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cookienovo.com/assets/client.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "ads_data_redaction"
              },
              {
                "type": 1,
                "string": "url_passthrough"
              },
              {
                "type": 1,
                "string": "developer_id.dMjZhMT"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "cookienovo_token"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "cookienovo_injected"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Script was loaded
  code: |-
    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: Token was set
  code: |-
    runCode(mockData);

    assertApi('setInWindow').wasCalledWith('cookienovo_token', '1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF', true);
    // assertApi('setInWindow').wasCalledWith('cookienovo_injected', true, true);
- name: Default consent status was set
  code: |-
    runCode(mockData);
    assertApi('setDefaultConsentState').wasCalledWith({
      "ad_storage":"denied",
      "ad_user_data":"denied",
      "ad_personalization":"denied",
      "analytics_storage":"denied",
      "functionality_storage": "denied",
      "wait_for_update": 2000
    });
- name: Set Google configs
  code: |-
    runCode(mockData);
    assertApi('gtagSet').wasCalledWith('ads_data_redaction', false);
    assertApi('gtagSet').wasCalledWith('url_passthrough', true);
- name: Developer ID was set
  code: |-
    runCode(mockData);
    assertApi('gtagSet').wasCalledWith('developer_id.dMjZhMT', true);
- name: Consent was granted
  code: |-
    mock('getCookieValues', (name) => {
      switch (name) {
        case 'cn-category-analytics':
        case 'cn-category-functional':
        case 'cn-category-marketing':
          return ['1'];
      }
      return [];
    });

    runCode(mockData);

    assertApi('updateConsentState').wasCalledWith({
      "ad_storage":"granted",
      "ad_user_data":"granted",
      "ad_personalization":"granted",
      "analytics_storage":"granted",
      "functionality_storage": "granted"
    });
- name: Regional settings
  code: |-
    mockData.region_specific = [
      {"region":"SK","functionality":"granted","analytics":"denied","marketing":"denied"},
      {"region":"ES,PT","functionality":"granted","analytics":"granted","marketing":"denied"},
      {"region":"US-AS","functionality":"granted","analytics":"granted","marketing":"granted"}
    ];

    runCode(mockData);

    // default consent state
    assertApi('setDefaultConsentState').wasCalledWith({
      "ad_storage":"denied",
      "ad_user_data":"denied",
      "ad_personalization":"denied",
      "analytics_storage":"denied",
      "functionality_storage": "denied",
      "wait_for_update": 2000
    });

    assertApi('setDefaultConsentState').wasCalledWith({
      "ad_storage":"denied",
      "ad_user_data":"denied",
      "ad_personalization":"denied",
      "analytics_storage":"denied",
      "functionality_storage": "granted",
      "region": ["SK"]
    });


    assertApi('setDefaultConsentState').wasCalledWith({
      "ad_storage":"denied",
      "ad_user_data":"denied",
      "ad_personalization":"denied",
      "analytics_storage":"granted",
      "functionality_storage": "granted",
      "region": ["ES", "PT"]
    });

    assertApi('setDefaultConsentState').wasCalledWith({
      "ad_storage":"granted",
      "ad_user_data":"granted",
      "ad_personalization":"granted",
      "analytics_storage":"granted",
      "functionality_storage": "granted",
      "region": ["US-AS"]
    });
setup: |-
  let mockData = {
    'id': '1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF',
    'consent_mode_enabled': true,
    'default_consent_functionality': 'denied',
    'default_consent_analytics': 'denied',
    'default_consent_marketing': 'denied',
    'wait_for_update': 2000,
    'ads_data_redaction': false,
    'url_passthrough': true,
  };

  let cookies = {};

  mock('injectScript', (url, onSuccess, onError) => {
    onSuccess();
  });

  mock('getCookieValues', (name) => {
    return [];
  });


___NOTES___

Created on 5. 3. 2025 20:59:32


